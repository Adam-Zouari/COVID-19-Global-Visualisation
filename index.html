<!DOCTYPE html>

<head>
    <title>COVID-19 Visualizer</title>
    <!-- Meta -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- CSS / Favicon -->
    <link href="styles.css" rel="stylesheet" />
    <link href="compare-styles.css" rel="stylesheet" />

    <!-- Core JavaScript Libraries -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

    <!-- Core Application Files -->
    <script src="dataService.js" defer></script>

    <!-- Globe Modules -->
    <script src="globe/MiniGlobe.js" defer></script>
    <script src="globe/GlobeVis.js" defer></script>
    <script src="globe/GlobeEvents.js" defer></script>
    <script src="globe/GlobeRendering.js" defer></script>
    <script src="globe/GlobeCountries.js" defer></script>
    <script src="globe/GlobeAnimation.js" defer></script>
    <script src="globe/main.js" defer></script>

    <!-- Modular Components -->
    <script src="uiUtils.js" defer></script>
    <script src="search.js" defer></script>
    <script src="visualizations.js" defer></script>
    <script src="chartFactory.js" defer></script>

    <!-- Chart Controls -->
    <script src="chartControls.js" defer></script>

    <!-- Chart Implementations -->
    <script src="charts/barChart.js" defer></script>
    <script src="charts/lineChart.js" defer></script>
    <script src="charts/pieChart.js" defer></script>
    <script src="charts/radarChart.js" defer></script>
    <script src="charts/heatmapChart.js" defer></script>
    <script src="charts/multiCountryChart.js" defer></script>

    <!-- Compare Feature -->
    <script src="compare.js" defer></script>
</head>

<body>
    <!-- Main containers -->
    <div id="particles"></div>
    <div id="globe" class="centered-globe"></div>

    <!-- Header -->
    <div id="header">
        <div id="search">
            <img src="assets/icons/search.svg" onclick="openSearch()">
        </div>

        <!-- Dataset buttons -->
        <div class="dataset-buttons">
            <button id="epidemBtn" class="dataset-btn active" onclick="changeDataset('epidem')" title="Epidemiology">
                <img src="assets/icons/virus.svg" class="dataset-icon" alt="Epidemiology">
            </button>
            <button id="hospBtn" class="dataset-btn" onclick="changeDataset('hospitalizations')" title="Hospitalizations">
                <img src="assets/icons/hospital.svg" class="dataset-icon" alt="Hospitalizations">
            </button>
            <button id="vaccBtn" class="dataset-btn" onclick="changeDataset('vaccinations')" title="Vaccinations">
                <img src="assets/icons/syringe.svg" class="dataset-icon" alt="Vaccinations">
            </button>
        </div>

        <h1>COVID-19</h1>
    </div>

    <!-- Search Modal Overlay -->
    <div id="searchModal" class="search-modal">
        <div class="search-container">
            <div class="search-header">
                <h3>Search Countries</h3>
                <button class="close-search" onclick="closeSearch()">×</button>
            </div>
            <input type="text" id="countrySearchInput" placeholder="Type country name..." autocomplete="off">
            <div id="countryList" class="country-list"></div>
        </div>
    </div>

    <!-- Country Info Panel -->
    <div id="countryInfo">
        <h3 id="countryName">Select a country</h3>
        <div id="countryStats"></div>
        <!-- Add the See More button -->
        <button id="seeMoreBtn" onclick="showVisualizations()">See More Visualizations</button>
        <!-- Add the Compare button -->
        <button id="compareBtn" onclick="showComparePanel()">Compare</button>
    </div>

    <!-- Controls Panel -->
    <div class="control-panel">
        <div class="dataset-indicator">
            <span id="currentDataset">Epidemiology</span>
        </div>

        <div class="data-selector-container">
            <label for="dataSelector">Data Type: </label>
            <select id="dataSelector"></select>
        </div>

        <div class="date-controls">
            <button id="prevDateBtn">&lt;</button>
            <span id="currentDate">Loading...</span>
            <button id="nextDateBtn">&gt;</button>
        </div>

        <input type="range" id="dateSlider" min="0" max="100" value="0">

        <button id="resetBtn" class="control-btn">Reset View</button>
    </div>

    <!-- Loading indicator -->
    <div id="loader"></div>
    <div id="dataStatus">Loading data...</div>

    <!-- Error display for data loading issues -->
    <div id="errorDisplay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1000; color: white; padding: 20px; flex-direction: column; align-items: center; justify-content: center;">
        <h2>Data Loading Error</h2>
        <div id="errorMessage"></div>
        <button id="errorClose" style="margin-top: 20px; padding: 8px 16px;">Close</button>
    </div>

    <!-- Visualization Panel -->
    <div id="visualizationPanel">
        <div class="viz-header">
            <div class="viz-title">
                <img id="viz-flag" src="" alt="Country Flag">
                <h2 id="viz-country-name">Country Data</h2>
            </div>
            <div class="viz-controls">
                <select id="vizTypeSelector" class="viz-selector" onchange="changeVisualization()">
                    <option value="bar">Bar Chart</option>
                    <option value="line">Line Chart</option>
                    <option value="pie">Pie Chart</option>
                    <option value="radar">Radar Chart</option>
                    <option value="heatmap">Heat Map</option>
                </select>
            </div>
        </div>
        <div class="viz-content">
            <div id="chartContainer" class="chart-container"></div>
        </div>
    </div>

    <!-- Minimized Globe Container -->
    <div id="minimizedGlobe" class="globe-minimized" style="display:none" onclick="restoreGlobe()"></div>

    <!-- Compare Panel -->
    <div id="comparePanel" class="compare-panel">
        <div class="compare-header">
            <h2>Compare Countries</h2>
            <button id="closeCompareBtn" onclick="closeComparePanel()">×</button>
        </div>

        <div class="compare-content">
            <div class="country-selection-container">
                <div class="country-selection">
                    <div class="country-slot" id="countrySlot1">
                        <div class="country-placeholder">Select Country 1</div>
                        <button class="select-country-btn" onclick="openCountrySelector(1)">Select</button>
                    </div>

                    <div class="country-slot" id="countrySlot2">
                        <div class="country-placeholder">Select Country 2</div>
                        <button class="select-country-btn" onclick="openCountrySelector(2)">Select</button>
                    </div>

                    <div class="country-slot" id="countrySlot3" style="display:none">
                        <div class="country-placeholder">Select Country 3</div>
                        <button class="select-country-btn" onclick="openCountrySelector(3)">Select</button>
                    </div>

                    <div class="country-slot" id="countrySlot4" style="display:none">
                        <div class="country-placeholder">Select Country 4</div>
                        <button class="select-country-btn" onclick="openCountrySelector(4)">Select</button>
                    </div>

                    <div class="add-country-container">
                        <button id="addCountryBtn" onclick="addCountrySlot()">+ Add Country</button>
                    </div>
                </div>

                <div class="display-options">
                    <div class="display-option">
                        <label>Display Mode:</label>
                        <div class="display-buttons">
                            <button id="separateChartsBtn" class="display-btn active" onclick="setDisplayMode('separate')">
                                Separate Charts
                            </button>
                            <button id="combinedChartBtn" class="display-btn" onclick="setDisplayMode('combined')">
                                Combined Chart
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="compare-actions">
                <button id="generateComparisonBtn" onclick="generateComparison()">Generate Comparison</button>
            </div>
        </div>
    </div>

    <!-- Compare Country Selector -->
    <div id="compareCountrySelector" class="compare-country-selector">
        <div class="selector-header">
            <h3>Select a Country</h3>
            <button class="close-selector" onclick="closeCountrySelector()">×</button>
        </div>

        <div class="selector-content">
            <input type="text" id="compareCountrySearchInput" placeholder="Type country name..." autocomplete="off">
            <div id="compareCountryList" class="compare-country-list"></div>
        </div>
    </div>

    <!-- Compare Visualization Panel -->
    <div id="compareVisualizationPanel" class="compare-visualization-panel">
        <div class="viz-header">
            <div class="viz-title">
                <h2>Country Comparison</h2>
            </div>
            <div class="viz-controls">
                <select id="compareVizTypeSelector" class="viz-selector" onchange="changeComparisonVisualization()">
                    <option value="bar">Bar Chart</option>
                    <option value="line">Line Chart</option>
                    <option value="pie">Pie Chart</option>
                    <option value="radar">Radar Chart</option>
                    <option value="heatmap">Heat Map</option>
                </select>
                <button id="backToCompareBtn" onclick="backToComparePanel()">Back to Selection</button>
            </div>
        </div>

        <div class="viz-content">
            <div id="compareChartContainer" class="compare-chart-container"></div>
        </div>
    </div>
</body>

</html>
